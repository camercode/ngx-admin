/**
          * @ag-grid-enterprise/clipboard - Advanced Data Grid / Data Table supporting Javascript / Typescript / React / Angular / Vue * @version v27.2.1
          * @link http://www.ag-grid.com/
          * @license Commercial
          */
/**
          * @ag-grid-enterprise/clipboard - Advanced Data Grid / Data Table supporting Javascript / Typescript / React / Angular / Vue * @version v27.2.1
          * @link http://www.ag-grid.com/
          * @license Commercial
          */
import{Constants as e,_ as o,Events as t,ChangedPath as r,Autowired as i,Optional as n,PostConstruct as a,Bean as s,BeanStub as l,ModuleNames as p}from"@ag-grid-community/core";import{EnterpriseCoreModule as c}from"@ag-grid-enterprise/core";import{CsvExportModule as d}from"@ag-grid-community/csv-export";var u,h=(u=function(e,o){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,o){e.__proto__=o}||function(e,o){for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t])})(e,o)},function(e,o){function t(){this.constructor=e}u(e,o),e.prototype=null===o?Object.create(o):(t.prototype=o.prototype,new t)}),g=function(e,o,t,r){var i,n=arguments.length,a=n<3?o:null===r?r=Object.getOwnPropertyDescriptor(o,t):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,o,t,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(n<3?i(a):n>3?i(o,t,a):i(o,t))||a);return n>3&&a&&Object.defineProperty(o,t,a),a},v=function(e,o){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,i,n=t.call(e),a=[];try{for(;(void 0===o||o-- >0)&&!(r=n.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(i)throw i.error}}return a},f=function(){for(var e=[],o=0;o<arguments.length;o++)e=e.concat(v(arguments[o]));return e},y=function(l){function p(){var e=null!==l&&l.apply(this,arguments)||this;return e.navigatorApiFailed=!1,e}return h(p,l),p.prototype.init=function(){var o=this;this.logger=this.loggerFactory.create("ClipboardService"),this.rowModel.getType()===e.ROW_MODEL_TYPE_CLIENT_SIDE&&(this.clientSideRowModel=this.rowModel),this.ctrlsService.whenReady((function(e){o.gridCtrl=e.gridCtrl}))},p.prototype.pasteFromClipboard=function(){var e=this;this.logger.log("pasteFromClipboard"),!this.gridOptionsWrapper.isSuppressClipboardApi()&&!this.navigatorApiFailed&&navigator.clipboard&&navigator.clipboard.readText?navigator.clipboard.readText().then(this.processClipboardData.bind(this)).catch((function(t){o.doOnce((function(){console.warn(t),console.warn("AG Grid: Unable to use the Clipboard API (navigator.clipboard.readText()). The reason why it could not be used has been logged in the previous line. For this reason the grid has defaulted to using a workaround which doesn't perform as well. Either fix why Clipboard API is blocked, OR stop this message from appearing by setting grid property suppressClipboardApi=true (which will default the grid to using the workaround rather than the API")}),"clipboardApiError"),e.navigatorApiFailed=!0,e.pasteFromClipboardLegacy()})):this.pasteFromClipboardLegacy()},p.prototype.pasteFromClipboardLegacy=function(){var e=this;this.executeOnTempElement((function(e){return e.focus({preventScroll:!0})}),(function(o){var t=o.value;e.processClipboardData(t)}))},p.prototype.processClipboardData=function(e){var t=this;if(null!=e){var r=o.stringToArray(e,this.gridOptionsWrapper.getClipboardDelimiter()),i=this.gridOptionsWrapper.getProcessDataFromClipboardFunc();if(i&&(r=i({data:r})),null!=r){this.gridOptionsWrapper.isSuppressLastEmptyLineOnPaste()&&this.removeLastLineIfBlank(r);this.doPasteOperation((function(e,o,i,n){t.rangeService&&t.rangeService.isMoreThanOneCell()&&!t.hasOnlyOneValueToPaste(r)?t.pasteIntoActiveRange(r,e,o,n):t.pasteStartingFromFocusedCell(r,e,o,i,n)}))}}},p.prototype.doPasteOperation=function(e){var o,i=this.gridOptionsWrapper.getApi(),n=this.gridOptionsWrapper.getColumnApi();if(this.eventService.dispatchEvent({type:t.EVENT_PASTE_START,api:i,columnApi:n,source:"clipboard"}),this.clientSideRowModel){var a=this.gridOptionsWrapper.isAggregateOnlyChangedColumns();o=new r(a,this.clientSideRowModel.getRootNode())}var s={},l=[],p=this.focusService.getFocusedCell();e(s,l,p,o),o&&this.clientSideRowModel.doAggregate(o),this.rowRenderer.refreshCells(),this.dispatchFlashCells(s),this.fireRowChanged(l),p&&this.focusService.setFocusedCell(p.rowIndex,p.column,p.rowPinned,!0),this.eventService.dispatchEvent({type:t.EVENT_PASTE_END,api:i,columnApi:n,source:"clipboard"})},p.prototype.pasteIntoActiveRange=function(o,t,r,i){var n=this,a=this.getRangeSize()%o.length!=0,s=0,l=0;this.iterateActiveRanges(!1,(function(p,c,d,u){if(u-s>=o.length){if(a)return;s+=l,l=0}var h=o[u-s];r.push(c);var g=n.gridOptionsWrapper.getProcessCellFromClipboardFunc();d.forEach((function(o,r){if(o.isCellEditable(c)&&!o.isSuppressPaste(c)){r>=h.length&&(r%=h.length);var a=n.processCell(c,o,h[r],e.EXPORT_TYPE_DRAG_COPY,g);c.setDataValue(o,a,e.SOURCE_PASTE),i&&i.addParentNode(c.parent,[o]);var s=n.cellPositionUtils.createIdFromValues(p.rowIndex,o,p.rowPinned);t[s]=!0}})),l++}))},p.prototype.pasteStartingFromFocusedCell=function(o,t,r,i,n){if(i){var a={rowIndex:i.rowIndex,rowPinned:i.rowPinned},s=this.columnModel.getDisplayedColumnsStartingAt(i.column);this.isPasteSingleValueIntoRange(o)?this.pasteSingleValueIntoRange(o,r,t,n):this.pasteMultipleValues(o,a,r,s,t,e.EXPORT_TYPE_CLIPBOARD,n)}},p.prototype.isPasteSingleValueIntoRange=function(e){return this.hasOnlyOneValueToPaste(e)&&null!=this.rangeService&&!this.rangeService.isEmpty()},p.prototype.pasteSingleValueIntoRange=function(o,t,r,i){var n=this,a=o[0][0];this.iterateActiveRanges(!1,(function(o,s,l){t.push(s),l.forEach((function(o){return n.updateCellValue(s,o,a,r,e.EXPORT_TYPE_CLIPBOARD,i)}))}))},p.prototype.hasOnlyOneValueToPaste=function(e){return 1===e.length&&1===e[0].length},p.prototype.copyRangeDown=function(){var o=this;if(this.rangeService&&!this.rangeService.isEmpty()){var t=[];this.doPasteOperation((function(r,i,n,a){var s=o.gridOptionsWrapper.getProcessCellForClipboardFunc(),l=o.gridOptionsWrapper.getProcessCellFromClipboardFunc();o.iterateActiveRanges(!0,(function(n,p,c){t.length?(i.push(p),c.forEach((function(i,s){if(i.isCellEditable(p)&&!i.isSuppressPaste(p)){var c=o.processCell(p,i,t[s],e.EXPORT_TYPE_DRAG_COPY,l);p.setDataValue(i,c,e.SOURCE_PASTE),a&&a.addParentNode(p.parent,[i]);var d=o.cellPositionUtils.createIdFromValues(n.rowIndex,i,n.rowPinned);r[d]=!0}}))):c.forEach((function(r){var i=o.processCell(p,r,o.valueService.getValue(r,p),e.EXPORT_TYPE_DRAG_COPY,s);t.push(i)}))}))}))}},p.prototype.removeLastLineIfBlank=function(e){var t=o.last(e);t&&1===t.length&&""===t[0]&&o.removeFromArray(e,t)},p.prototype.fireRowChanged=function(e){var o=this;this.gridOptionsWrapper.isFullRowEdit()&&e.forEach((function(e){var r={type:t.EVENT_ROW_VALUE_CHANGED,node:e,data:e.data,rowIndex:e.rowIndex,rowPinned:e.rowPinned,context:o.gridOptionsWrapper.getContext(),api:o.gridOptionsWrapper.getApi(),columnApi:o.gridOptionsWrapper.getColumnApi()};o.eventService.dispatchEvent(r)}))},p.prototype.pasteMultipleValues=function(e,o,t,r,i,n,a){var s=this,l=o,p=null!=this.clientSideRowModel&&!this.gridOptionsWrapper.isTreeData();e.forEach((function(e){var o=function(){for(;;){if(!l)return null;var e=s.rowPositionUtils.getRowNode(l);if(l=s.cellNavigationService.getRowBelow({rowPinned:l.rowPinned,rowIndex:l.rowIndex}),null==e)return null;if(!(e.detail||e.footer||p&&e.group))return e}}();o&&(e.forEach((function(e,t){return s.updateCellValue(o,r[t],e,i,n,a)})),t.push(o))}))},p.prototype.updateCellValue=function(o,t,r,i,n,a){if(o&&t&&t.isCellEditable(o)&&!t.isSuppressPaste(o)){var s=this.processCell(o,t,r,n,this.gridOptionsWrapper.getProcessCellFromClipboardFunc());o.setDataValue(t,s,e.SOURCE_PASTE),i[this.cellPositionUtils.createIdFromValues(o.rowIndex,t,o.rowPinned)]=!0,a&&a.addParentNode(o.parent,[t])}},p.prototype.copyToClipboard=function(e){void 0===e&&(e={});var o=e.includeHeaders,t=e.includeGroupHeaders;this.logger.log("copyToClipboard: includeHeaders = "+o),null==o&&(o=this.gridOptionsWrapper.isCopyHeadersToClipboard()),null==t&&(t=this.gridOptionsWrapper.isCopyGroupHeadersToClipboard());var r={includeHeaders:o,includeGroupHeaders:t},i=!this.selectionService.isEmpty()&&!this.gridOptionsWrapper.isSuppressCopyRowsToClipboard();this.rangeService&&this.rangeService.isMoreThanOneCell()?this.copySelectedRangeToClipboard(r):i?this.copySelectedRowsToClipboard(r):this.focusService.isAnyCellFocused()?this.copyFocusedCellToClipboard(r):this.copySelectedRangeToClipboard(r)},p.prototype.iterateActiveRanges=function(e,o,t){var r=this;if(this.rangeService&&!this.rangeService.isEmpty()){var i=this.rangeService.getCellRanges();e?this.iterateActiveRange(i[0],o,t,!0):i.forEach((function(e,n){return r.iterateActiveRange(e,o,t,n===i.length-1)}))}},p.prototype.iterateActiveRange=function(e,o,t,r){if(this.rangeService){var i=this.rangeService.getRangeStartRow(e),n=this.rangeService.getRangeEndRow(e);t&&e.columns&&t(e.columns);for(var a=0,s=!1;!s&&null!=i;){var l=this.rowPositionUtils.getRowNode(i);s=this.rowPositionUtils.sameRow(i,n),o(i,l,e.columns,a++,s&&r),i=this.cellNavigationService.getRowBelow(i)}}},p.prototype.copySelectedRangeToClipboard=function(e){if(void 0===e&&(e={}),this.rangeService&&!this.rangeService.isEmpty()){var o=this.rangeService.areAllRangesAbleToMerge()?this.buildDataFromMergedRanges(e):this.buildDataFromRanges(e),t=o.data,r=o.cellsToFlash;this.copyDataToClipboard(t),this.dispatchFlashCells(r)}},p.prototype.buildDataFromMergedRanges=function(e){var o=this,t=new Set,r=this.rangeService.getCellRanges(),i=[],n={};r.forEach((function(e){e.columns.forEach((function(e){return t.add(e)}));var r=o.getRangeRowPositionsAndCellsToFlash(e),a=r.rowPositions,s=r.cellsToFlash;i.push.apply(i,f(a)),Object.assign(n,s)}));var a=this.columnModel.getAllDisplayedColumns(),s=Array.from(t);return s.sort((function(e,o){return a.indexOf(e)-a.indexOf(o)})),{data:this.buildExportParams({columns:s,rowPositions:i,includeHeaders:e.includeHeaders,includeGroupHeaders:e.includeGroupHeaders}),cellsToFlash:n}},p.prototype.buildDataFromRanges=function(e){var o=this,t=this.rangeService.getCellRanges(),r=[],i={};return t.forEach((function(t){var n=o.getRangeRowPositionsAndCellsToFlash(t),a=n.rowPositions,s=n.cellsToFlash;Object.assign(i,s),r.push(o.buildExportParams({columns:t.columns,rowPositions:a,includeHeaders:e.includeHeaders,includeGroupHeaders:e.includeGroupHeaders}))})),{data:r.join("\n"),cellsToFlash:i}},p.prototype.getRangeRowPositionsAndCellsToFlash=function(e){for(var o=this,t=[],r={},i=this.rangeService.getRangeStartRow(e),n=this.rangeService.getRangeEndRow(e),a=i;a&&(t.push(a),e.columns.forEach((function(e){var t=o.cellPositionUtils.createIdFromValues(a.rowIndex,e,a.rowPinned);r[t]=!0})),!this.rowPositionUtils.sameRow(a,n));)a=this.cellNavigationService.getRowBelow(a);return{rowPositions:t,cellsToFlash:r}},p.prototype.copyFocusedCellToClipboard=function(e){var o;void 0===e&&(e={});var t=this.focusService.getFocusedCell();if(null!=t){var r=this.cellPositionUtils.createId(t),i={rowPinned:t.rowPinned,rowIndex:t.rowIndex},n=t.column,a=this.buildExportParams({columns:[n],rowPositions:[i],includeHeaders:e.includeHeaders,includeGroupHeaders:e.includeGroupHeaders});this.copyDataToClipboard(a),this.dispatchFlashCells(((o={})[r]=!0,o))}},p.prototype.copySelectedRowsToClipboard=function(e){void 0===e&&(e={});var o=e.columnKeys,t=e.includeHeaders,r=e.includeGroupHeaders,i=this.buildExportParams({columns:o,includeHeaders:t,includeGroupHeaders:r});this.copyDataToClipboard(i)},p.prototype.buildExportParams=function(e){var o=e.columns,t=e.rowPositions,r=e.includeHeaders,i=void 0!==r&&r,n=e.includeGroupHeaders,a={columnKeys:o,rowNodes:t,skipColumnHeaders:!i,skipColumnGroupHeaders:!(void 0!==n&&n),suppressQuotes:!0,columnSeparator:this.gridOptionsWrapper.getClipboardDelimiter(),onlySelected:!t,processCellCallback:this.gridOptionsWrapper.getProcessCellForClipboardFunc(),processRowGroupCallback:function(e){return e.node.key},processHeaderCallback:this.gridOptionsWrapper.getProcessHeaderForClipboardFunc(),processGroupHeaderCallback:this.gridOptionsWrapper.getProcessGroupHeaderForClipboardFunc()};return this.csvCreator.getDataAsCsv(a)},p.prototype.dispatchFlashCells=function(e){var o=this;window.setTimeout((function(){var r={type:t.EVENT_FLASH_CELLS,cells:e,api:o.gridApi,columnApi:o.columnApi};o.eventService.dispatchEvent(r)}),0)},p.prototype.processCell=function(e,o,t,r,i){return i?i({column:o,node:e,value:t,type:r}):t},p.prototype.copyDataToClipboard=function(e){var t=this,r=this.gridOptionsWrapper.getSendToClipboardFunc();r?r({data:e}):!this.gridOptionsWrapper.isSuppressClipboardApi()&&navigator.clipboard?navigator.clipboard.writeText(e).catch((function(r){o.doOnce((function(){console.warn(r),console.warn("AG Grid: Unable to use the Clipboard API (navigator.clipboard.writeText()). The reason why it could not be used has been logged in the previous line. For this reason the grid has defaulted to using a workaround which doesn't perform as well. Either fix why Clipboard API is blocked, OR stop this message from appearing by setting grid property suppressClipboardApi=true (which will default the grid to using the workaround rather than the API.")}),"clipboardApiError"),t.copyDataToClipboardLegacy(e)})):this.copyDataToClipboardLegacy(e)},p.prototype.copyDataToClipboardLegacy=function(e){var o=this;this.executeOnTempElement((function(t){var r=o.gridOptionsWrapper.getDocument(),i=r.activeElement;t.value=e||" ",t.select(),t.focus({preventScroll:!0}),r.execCommand("copy")||console.warn("AG Grid: Browser did not allow document.execCommand('copy'). Ensure api.copySelectedRowsToClipboard() is invoked via a user event, i.e. button click, otherwise the browser will prevent it for security reasons."),null!=i&&null!=i.focus&&i.focus({preventScroll:!0})}))},p.prototype.executeOnTempElement=function(e,o){var t=this.gridOptionsWrapper.getDocument(),r=t.createElement("textarea");r.style.width="1px",r.style.height="1px",r.style.top=t.documentElement.scrollTop+"px",r.style.left=t.documentElement.scrollLeft+"px",r.style.position="absolute",r.style.opacity="0";var i=this.gridCtrl.getGui();i.appendChild(r);try{e(r)}catch(e){console.warn("AG Grid: Browser does not support document.execCommand('copy') for clipboard operations")}o?window.setTimeout((function(){o(r),i.removeChild(r)}),100):i.removeChild(r)},p.prototype.getRangeSize=function(){var e=this.rangeService.getCellRanges(),o=0,t=0;return e.length>0&&(o=this.rangeService.getRangeStartRow(e[0]).rowIndex,t=this.rangeService.getRangeEndRow(e[0]).rowIndex),o-t+1},g([i("csvCreator")],p.prototype,"csvCreator",void 0),g([i("loggerFactory")],p.prototype,"loggerFactory",void 0),g([i("selectionService")],p.prototype,"selectionService",void 0),g([n("rangeService")],p.prototype,"rangeService",void 0),g([i("rowModel")],p.prototype,"rowModel",void 0),g([i("ctrlsService")],p.prototype,"ctrlsService",void 0),g([i("valueService")],p.prototype,"valueService",void 0),g([i("focusService")],p.prototype,"focusService",void 0),g([i("rowRenderer")],p.prototype,"rowRenderer",void 0),g([i("columnModel")],p.prototype,"columnModel",void 0),g([i("cellNavigationService")],p.prototype,"cellNavigationService",void 0),g([i("columnApi")],p.prototype,"columnApi",void 0),g([i("gridApi")],p.prototype,"gridApi",void 0),g([i("cellPositionUtils")],p.prototype,"cellPositionUtils",void 0),g([i("rowPositionUtils")],p.prototype,"rowPositionUtils",void 0),g([a],p.prototype,"init",null),p=g([s("clipboardService")],p)}(l),C={moduleName:p.ClipboardModule,beans:[y],dependantModules:[c,d]};export{C as ClipboardModule};